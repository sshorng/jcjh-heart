<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å»ºæˆå¿ƒèƒ½é‡</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Outfit:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SweetAlert2 & Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --primary-coral: #e66767;
            /* åŠ æ·±çŠç‘šç´… */
            --soft-cream: #fcebe6;
            /* å†æ¬¡åŠ æ·±èƒŒæ™¯åŸºæº–è‰² */
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.4);
            --font-main: 'Outfit', 'Noto Sans TC', sans-serif;
            --card-shadow: 0 15px 50px rgba(107, 79, 79, 0.18);
            /* æé«˜é™°å½±ä¸é€æ˜åº¦ */
        }


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-main);
        }

        body {
            font-family: var(--font-main);
            background: var(--soft-cream);
            margin: 0;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            color: #2d3436;
        }

        /* å·”å³°è³ªæ„Ÿï¼šæµé«”å‹•æ…‹æ¼¸å±¤èƒŒæ™¯ */
        .ambient-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--soft-cream);
            /* åŠ å…¥æ¥µè–„çš„é¡†ç²’æ„Ÿç´‹ç†ï¼Œæ‰“ç ´å¤§è¢å¹•çš„ç³ŠåŒ–æ„Ÿ */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            background-blend-mode: soft-light;
            opacity: 0.96;
            z-index: -1;
            overflow: hidden;
        }

        .ambient-glow::before,
        .ambient-glow::after {
            content: '';
            position: absolute;
            width: 80vmax;
            height: 80vmax;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.35;
            /* å†æ¬¡æé«˜å…‰æšˆä¸é€æ˜åº¦ */
            z-index: -1;
            animation: drift 25s infinite alternate ease-in-out;
        }

        .ambient-glow::before {
            background: radial-gradient(circle, #ff6b6b 0%, transparent 70%);
            /* åŠ æ·±å…‰æšˆé¡è‰² */
            top: -20%;
            left: -10%;
        }

        .ambient-glow::after {
            background: radial-gradient(circle, #f08a8a 0%, transparent 70%);
            /* åŠ æ·±å…‰æšˆé¡è‰² */
            bottom: -20%;
            right: -10%;
            animation-duration: 35s;
            animation-delay: -5s;
        }

        @keyframes drift {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
            }

            50% {
                transform: translate(10%, 15%) scale(1.1) rotate(10deg);
            }

            100% {
                transform: translate(-5%, -10%) scale(1) rotate(-5deg);
            }
        }

        header {
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 300;
            /* é«˜æ–¼å¡ç‰‡ç‰† */
            position: relative;
        }

        .header-content {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 0.8rem 1.8rem;
            border-radius: 40px;
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 1.2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
        }

        .header-bar {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 0.7rem 1.6rem;
            border-radius: 50px;
            border: 1px solid rgba(255, 192, 203, 0.4);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 1.2rem;
            transition: all 0.3s ease;
        }

        .header-bar .logo-icon {
            width: 44px;
            height: 44px;
            background: #ff6b6b;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .header-bar .header-title {
            display: flex;
            flex-direction: column;
        }

        .tagline-main {
            font-size: 1.4rem;
            font-weight: 700;
            color: #4a3e3e;
            letter-spacing: 1px;
        }

        .tagline-sub {
            font-size: 0.8rem;
            color: #999;
        }

        .header-title {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #f27979 0%, #ffb3b3 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 8px 20px rgba(242, 121, 121, 0.3);
        }

        .logo-text h1 {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0;
            letter-spacing: 1px;
            color: var(--primary-coral);
        }

        .logo-text p {
            font-size: 0.75rem;
            margin: 0;
            opacity: 0.6;
        }

        .header-actions {
            display: none;
        }

        /* æ•´åˆå¼åŠŸèƒ½å€çµ„ä»¶ */
        .fab-container {
            position: fixed;
            bottom: 2.5rem;
            right: 2.5rem;
            z-index: 50;
            /* èª¿ä½ z-index è®“å¡ç‰‡èƒ½é®æ“‹ */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .fab-qr-wrapper {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            background: white;
            /* ç¢ºä¿èƒŒæ™¯ç´”ç™½æå‡å°æ¯” */
            padding: 10px;
            border-radius: 20px;
            border: 1px solid var(--primary-coral);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .fab-qr-wrapper:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.7);
        }

        .fab-qr-img {
            width: 110px;
            height: 110px;
            display: block;
            border-radius: 8px;
            /* ç§»é™¤å¯èƒ½é™ä½å°æ¯”åº¦çš„è¦–è¦ºæ•ˆæœ */
        }

        .admin-entry button {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: #636e72;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .admin-entry button:hover {
            background: rgba(255, 255, 255, 0.6);
            color: var(--primary-coral);
            transform: translateY(-2px);
        }

        /* ç•™è¨€å±•ç¤ºå€ */
        #messageBoard {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 200;
            /* é«˜æ–¼æŒ‰éˆ•ï¼Œè®“å¡ç‰‡èƒ½é®æ“‹åŠŸèƒ½å€ */
            pointer-events: none;
        }

        /* é ‚ç´šè³ªæ„Ÿï¼šé«˜ç´šç´™è³ªèˆ‡ç´™è† å¸¶å¡ç‰‡ */
        .message-card {
            background: #fffdf9;
            background-image:
                radial-gradient(#e5e5e5 0.5px, transparent 0.5px),
                linear-gradient(rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.2));
            background-size: 20px 20px, 100% 100%;
            border-radius: 12px;
            padding: 2.22rem;
            padding-top: 3.2rem;
            width: 340px;
            min-height: 220px;
            box-shadow: var(--card-shadow);
            position: absolute;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            will-change: transform, opacity;
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            border: 1px solid #e8d5d5;
            /* åŠ å…¥å¯¦é«”ç´°é‚Šæ¡†ï¼Œç¢ºä¿åœ¨ä»»ä½•è¢å¹•çš†æ¸…æ™° */
            z-index: 100;
            /* é«˜æ–¼æŒ‰éˆ•å€åŸŸ */
            pointer-events: auto;
        }

        /* é«˜å“è³ªå’Œç´™è† å¸¶ - æ•´é½Šåˆ‡é‚Š */
        .message-card::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%) rotate(0.5deg);
            width: 100px;
            height: 32px;
            background: rgba(255, 220, 180, 0.5);
            backdrop-filter: blur(4px);
            z-index: 5;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            /* å’Œç´™çº–ç¶­ç´‹ç† */
            background-image:
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 4px 4px;
        }

        /* è¡Œæ”¿é‡˜é¸å…¬å‘Šå°ˆç”¨æ¨£å¼ - é‡‘é‡‘è‰²ç³» */
        .message-card.pinned-card {
            background: #fffcf0;
            border: 2px solid #f1c40f;
            box-shadow: 0 20px 60px rgba(241, 196, 15, 0.15);
        }

        .message-card.pinned-card::before {
            background: rgba(241, 196, 15, 0.6);
            width: 120px;
            height: 35px;
            box-shadow: 0 2px 8px rgba(241, 196, 15, 0.2);
        }

        .badge-pinned {
            background: #f1c40f !important;
            color: #7f6000 !important;
            animation: pulse-gold 2s infinite;
        }

        @keyframes pulse-gold {
            0% {
                box-shadow: 0 0 0 0 rgba(241, 196, 15, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(241, 196, 15, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(241, 196, 15, 0);
            }
        }

        .message-card:hover {
            transform: translateY(-12px) rotate(var(--rot, 0deg)) scale(1.03) !important;
            box-shadow: 0 30px 70px rgba(139, 90, 43, 0.12);
            z-index: 400 !important;
            /* äº’å‹•æ™‚çµ•å°ç½®é ‚ */
        }

        /* æ¨™é¡Œæ•´åˆæ–¼ç´™å¼µä¸­ */
        .card-greeting {
            color: #b07d62;
            font-size: 1rem;
            font-weight: 700;
            padding-bottom: 8px;
            border-bottom: 1.5px solid rgba(176, 125, 98, 0.15);
            width: fit-content;
        }

        .card-content {
            font-size: var(--font-size, 1.4rem);
            line-height: 1.5;
            font-weight: 400;
            color: #4a3e3e;
            flex: 1;
            padding: 10px 0;
            word-break: break-all;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: visible;
        }

        /* ç•¶æœ‰æ›è¡Œæ™‚ï¼šæ”¹ç‚ºé å·¦ï¼Œä¸”é ‚éƒ¨å°é½Š */
        .card-content.has-newline {
            text-align: left;
            align-items: flex-start;
            justify-content: flex-start;
        }

        /* Markdown æ¨™ç±¤å¾®ä¿® */
        .card-content p {
            margin: 0 0 0.4em 0;
            width: 100%;
            line-height: inherit;
        }

        .card-content p:last-child {
            margin-bottom: 0;
        }

        .card-content ul,
        .card-content ol {
            padding-left: 1.2rem;
            margin: 0.2rem 0;
            text-align: left;
            width: 100%;
        }

        .card-content strong {
            color: var(--primary-coral);
        }

        /* éš±è—åŸç”Ÿæ»¾å‹•æ¢ï¼Œæ”¹ç”¨æ¥µç´°ç¾åŒ–ç‰ˆ */
        .card-content::-webkit-scrollbar {
            width: 3px;
        }

        .card-content::-webkit-scrollbar-thumb {
            background: rgba(176, 125, 98, 0.2);
            border-radius: 10px;
        }

        /* å­—ç´šç¸®æ”¾é¡åˆ¥ - èª¿æ•´æ•¸å€¼ï¼Œå¢åŠ  mini ç´šé¿å…æ’å¤§ */
        .size-large {
            --font-size: 1.55rem;
        }

        .size-medium {
            --font-size: 1.35rem;
        }

        .size-small {
            --font-size: 1.15rem;
        }

        .size-mini {
            --font-size: 0.95rem;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            padding-top: 1.2rem;
        }

        .card-author {
            color: #636e72;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .card-tag {
            font-size: 0.75rem;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        /* è«è˜­è¿ªå’Œè«§è‰²æ¨™ç±¤ */
        .card-tag {
            font-size: 0.75rem;
            padding: 5px 14px;
            border-radius: 8px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .tag-é¼“å‹µ {
            background: #d4e2d4;
            color: #4a7c59;
        }

        .tag-è®šç¾ {
            background: #f0e4d7;
            color: #b08968;
        }

        .tag-é—œå¿ƒ {
            background: #e3d5ca;
            color: #7f5539;
        }

        .tag-æ„Ÿè¬ {
            background: #dfd3c3;
            color: #8d7b70;
        }

        .tag-ç¥ç¦ {
            background: #f5ebe0;
            color: #d4a373;
        }

        /* ç²¾ç·»æŒ‰éˆ• */
        .card-like {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: #fff0f0;
            /* æ·ºç²‰è‰²èƒŒæ™¯ */
            border: 1px solid #ffdada;
            /* ç²‰è‰²é‚Šæ¡† */
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #e74c3c;
            /* æ„›å¿ƒå¿…é ˆæ˜¯é®®ç´…è‰² */
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(242, 121, 121, 0.1);
            z-index: 10;
        }

        .card-like:hover {
            transform: scale(1.1);
            background: #ffe5e5;
        }

        .card-like.liked {
            background: #ffdada;
            /* æŒ‰è®šå¾Œé¡è‰²åŠ æ·±ä¸€é» */
        }

        .like-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b6b;
            color: white;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 800;
        }

        /* æ‡¸æµ®æŒ‰éˆ•åŸå§‹ä½ç½® CSS å·²ç”± .fab-container æ¥ç®¡ */

        .fab {
            background: linear-gradient(135deg, #f27979 0%, #faa6a6 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            cursor: pointer;
            box-shadow: 0 15px 35px rgba(242, 121, 121, 0.3);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .btn-write-fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, #f27979 0%, #faa6a6 100%);
            color: white;
            padding: 1rem 2rem;
            border-radius: 30px;
            text-decoration: none;
            box-shadow: 0 15px 35px rgba(242, 121, 121, 0.3);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-weight: 700;
            font-size: 1.1rem;
            z-index: 100;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: none;
            cursor: pointer;
        }

        .btn-write-fab:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 45px rgba(255, 138, 113, 0.5);
        }

        /* åˆ†äº«å¯«ç•™è¨€ä½ˆç½® */
        .fab-wrapper {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 1rem;
        }

        .fab:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 45px rgba(212, 163, 115, 0.5);
        }

        .fab i {
            font-size: 1rem;
        }

        .fab-button-group {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .fab-secondary {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #d4a373;
            border: 2px solid #d4a373;
            padding: 1rem;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            box-shadow: 0 8px 25px rgba(242, 121, 121, 0.15);
        }

        .fab-secondary:hover {
            background: var(--primary-coral);
            color: white;
            transform: translateY(-3px) scale(1.05);
        }

        .fab-secondary.active {
            background: var(--primary-coral);
            color: white;
        }

        .pulsate {
            animation: pulsate 1.5s infinite;
        }

        @keyframes pulsate {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        /* å‹•ç•«æ•ˆæœ */
        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: rotate(var(--rot, 0deg)) translateY(20px) scale(0.95);
            }

            100% {
                opacity: 1;
                transform: rotate(var(--rot, 0deg)) translateY(0) scale(1);
            }
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: rotate(var(--rot, 0deg));
            }

            100% {
                opacity: 0;
                transform: rotate(var(--rot, 0deg)) translateY(-15px) scale(0.95);
            }
        }

        .animate-float {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .animate-float.fade-out {
            animation: fadeOut 0.8s ease-out forwards;
        }


        .admin-trigger {
            position: fixed;
            bottom: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            opacity: 0.05;
            cursor: pointer;
            z-index: 400;
        }

        .admin-trigger:hover {
            opacity: 0.3;
        }

        /* Modal è¦†è“‹å±¤ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(107, 79, 79, 0.3);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .modal-content {
            background: var(--soft-cream);
            padding: 2rem;
            border-radius: 20px;
            width: 95%;
            max-width: 800px;
            /* å¢åŠ å¯¬åº¦ä»¥é©æ‡‰ç®¡ç†ä»‹é¢ */
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(232, 153, 141, 0.3);
            box-shadow: 0 20px 60px rgba(107, 79, 79, 0.15);
            z-index: 1001;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            cursor: pointer;
            font-size: 1.5rem;
            color: #636e72;
            opacity: 0.5;
            transition: opacity 0.2s;
        }

        .modal-close:hover {
            opacity: 1;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        label {
            font-weight: bold;
            margin-bottom: 0.2rem;
            color: #4e342e;
        }

        input:not([type="checkbox"]):not([type="radio"]),
        select,
        textarea {
            width: 100%;
            padding: 0.8rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: inherit;
            font-size: 1rem;
            color: #4e342e;
            box-sizing: border-box;
            /* ç¢ºä¿ padding ä¸æœƒæ’ç ´å¯¬åº¦ */
        }

        button.btn-submit {
            background: linear-gradient(135deg, var(--primary-coral) 0%, #d4a373 100%);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(232, 153, 141, 0.3);
            transition: all 0.3s ease;
        }

        button.btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(232, 153, 141, 0.4);
        }


        /* ç®¡ç†è€…ä»‹é¢å°ˆå±¬ */
        .admin-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.5rem;
        }

        .tab-btn {
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
            border: 1px solid transparent;
            font-weight: bold;
            color: #636e72;
        }

        .tab-btn.active {
            background: var(--primary-coral);
            color: white;
        }


        .admin-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 50vh;
            overflow-y: auto;
        }

        .batch-actions {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
            background: rgba(232, 153, 141, 0.1);
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .admin-item {
            background: white;
            margin-bottom: 0.8rem;
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid #eee;
            display: flex;
            align-items: flex-start;
            /* æ”¹ç‚ºé ‚ç«¯å°é½Šï¼Œé¿å…å…§å®¹å¤šæ™‚æŒ‰éˆ•å±…ä¸­ */
            gap: 1rem;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .admin-item:hover {
            background: #fefefe;
            border-color: var(--primary-coral);
        }

        .admin-item .item-checkbox {
            flex-shrink: 0;
            width: 18px;
            height: 18px;
            margin-top: 4px;
        }

        .admin-item .item-info {
            flex: 1;
            min-width: 0;
        }

        .admin-item .item-meta {
            font-size: 0.75rem;
            color: #999;
            margin-bottom: 2px;
        }

        .admin-item .item-content {
            word-break: break-all;
            white-space: normal;
            /* å…è¨±æ›è¡Œ */
            color: #4a3e3e;
            margin: 5px 0;
            line-height: 1.4;
        }

        .admin-item .item-target {
            font-weight: 600;
            color: var(--primary-coral);
        }

        .admin-actions {
            display: flex;
            gap: 0.3rem;
            flex-shrink: 0;
        }

        .btn-approve {
            background: #27ae60;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .btn-reject {
            background: #c0392b;
            color: white;

            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }

            #messageBoard {
                padding: 1rem;
            }

            .message-card {
                width: 100%;
                position: relative !important;
                opacity: 1 !important;
                transform: none !important;
                animation: none !important;
            }

            .fab-container {
                bottom: 1.5rem;
                right: 1.5rem;
            }

            .fab {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }

            header {
                padding: 1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .header-content {
                width: 100%;
                justify-content: center;
            }

            .header-actions {
                width: 100%;
                justify-content: center;
            }
        }

        /* æŠ•ç¨¿å°ˆç”¨æ¨¡å¼ (Post-Only Mode) */
        body.post-only-mode #messageBoard,
        body.post-only-mode .fab-container,
        body.post-only-mode .admin-trigger {
            display: none !important;
        }

        /* æŠ•ç¨¿æ¨¡å¼ä¸‹ç¦æ­¢é—œé–‰æŠ•ç¨¿è¦–çª— */
        body.post-only-mode #postModal .modal-close {
            display: none !important;
        }
    </style>
</head>

<body>
    <div class="ambient-glow"></div>

    <header>
        <div class="header-content">
            <div class="logo-icon">ğŸŒ¸</div>
            <div class="logo-text">
                <h1>å»ºæˆå¿ƒèƒ½é‡</h1>
                <p>Digital Floating Message Gallery</p>
            </div>
        </div>
    </header>

    <div id="messageBoard"></div>

    <!-- æ•´åˆå¼åŠŸèƒ½çƒï¼šQR + å¯«ç•™è¨€ -->
    <!-- æ•´åˆå¼åŠŸèƒ½çƒï¼šQR + å¯«ç•™è¨€ -->
    <div class="fab-container">
        <!-- å¸¸é§ QR Code (æƒç¢¼å³ç”¨) -->
        <div id="shareWriteQrWrapper" class="fab-qr-wrapper" title="æƒç¢¼å³å¯å¯«ç•™è¨€ï¼ˆå…è¨­å®šï¼‰">
            <img id="fabQrImg" class="fab-qr-img" src="" alt="QR">
        </div>

        <button class="fab" onclick="openPostModal()">
            <i class="fas fa-feather-alt pulsate"></i>
            <span>å¯«ç•™è¨€</span>
        </button>
    </div>

    <!-- å³ä¸‹è§’éš±è—å…¥å£ -->
    <div class="admin-trigger" onclick="openAdminModal()"></div>


    <!-- éš±è—çš„å¾Œç«¯å…¥å£ -->
    <!-- <div class="admin-trigger" onclick="openAdminModal()"></div> -->

    <!-- ç•™è¨€ Modal -->
    <div id="postModal" class="modal-overlay" onclick="if(event.target === this) closeModal('postModal')">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('postModal')">&times;</span>
            <h2 style="color: var(--warm-coral); text-align: center; margin-bottom: 1.5rem;">
                æŠ•ç¨¿æº«æš–</h2>
            <form id="postForm">
                <!-- æº«é¦¨æé†’ -->
                <div
                    style="background: linear-gradient(135deg, #fff9e6 0%, #fff0f5 100%); padding: 1rem; border-radius: 12px; margin-bottom: 1rem; border-left: 4px solid var(--warm-coral);">
                    <p style="font-size: 0.85rem; color: var(--warm-brown); margin: 0; line-height: 1.6;">
                        ğŸ’ <strong>æŠ•ç¨¿å°æé†’</strong><br>
                        â€¢ è«‹ç”¨æ­£å‘ã€æº«æš–çš„æ–‡å­—å‚³éå¿ƒæ„<br>
                        â€¢ ç•™è¨€å°‡ç¶“è€å¸«å¯©æ ¸å¾Œå…¬é–‹é¡¯ç¤º<br>
                        â€¢ è«‹ä½¿ç”¨å­¸æ ¡å¸³è™Ÿç™»å…¥ï¼Œç³»çµ±æœƒè¨˜éŒ„å¸³è™Ÿï¼Œè«‹æ„›è­·æ ¡åœ’å‹å–„ç’°å¢ƒ
                    </p>
                </div>

                <label>å°èª°èªªè©±ï¼Ÿ</label>
                <input type="text" id="target" placeholder="ä¾‹å¦‚ï¼š701 å…¨é«”åŒå­¸ã€ç‹è€å¸«..." required>

                <label>æ¨™ç±¤</label>
                <select id="tag">
                    <option value="é¼“å‹µ">ğŸ’ª é¼“å‹µ</option>
                    <option value="è®šç¾">âœ¨ è®šç¾</option>
                    <option value="é—œå¿ƒ">ğŸ«‚ é—œå¿ƒ</option>
                    <option value="æ„Ÿè¬">ğŸ‚ æ„Ÿè¬</option>
                    <option value="ç¥ç¦">ğŸˆ ç¥ç¦</option>
                </select>

                <label>ç•™è¨€å…§å®¹</label>
                <div style="position: relative;">
                    <textarea id="content" rows="4" placeholder="å¯«ä¸‹ä½ çš„å¿ƒæ„ (60å­—ä»¥å…§)..." required maxlength="60"
                        oninput="updateCharCount()"></textarea>
                    <div id="charCount"
                        style="position: absolute; bottom: 10px; right: 10px; font-size: 0.75rem; color: #999; pointer-events: none;">
                        0 / 60</div>
                </div>

                <div
                    style="display: flex; align-items: center; gap: 0.8rem; margin-top: 0.5rem; background: rgba(139, 90, 43, 0.04); padding: 0.8rem; border-radius: 10px; border: 1px dashed rgba(139, 90, 43, 0.1);">
                    <div style="display: flex; align-items: center; gap: 0.4rem; white-space: nowrap;">
                        <input type="checkbox" id="isAnonymous" style="width: 18px; height: 18px; cursor: pointer;"
                            onchange="toggleAnonymousName()">
                        <label for="isAnonymous" style="margin: 0; font-weight: 600; cursor: pointer;">åŒ¿åç•™è¨€</label>
                    </div>
                    <div id="anonymousNameWrapper" style="display: none; flex: 1; min-width: 0;">
                        <input type="text" id="anonymousName"
                            style="width: 100%; padding: 6px 12px; font-size: 0.9rem; border: 1px solid #ddd; border-radius: 6px; background: white;"
                            placeholder="è‡ªè¨‚æš±ç¨± (é è¨­: å°å¤©ä½¿)" maxlength="10">
                    </div>
                </div>


                <div id="google-login-container"
                    style="margin-top: 1rem; text-align: center; position: relative; z-index: 1002;">
                    <p style="font-size: 0.85rem; margin-bottom: 0.5rem; color: #666;">* ç³»çµ±å°‡è¨˜éŒ„æ‚¨çš„ Google å¸³è™Ÿä»¥åˆ©ç¶­è­·ç’°å¢ƒç§©åº</p>
                    <!-- Google Login Button Placeholder -->
                    <div id="g_id_onload"
                        data-client_id="236765538215-6o3ol1tl1brqhbd2qfavomq38l7j17aq.apps.googleusercontent.com"
                        data-context="signin" data-ux_mode="popup" data-callback="handleCredentialResponse"
                        data-auto_prompt="false" style="z-index: 2000;">
                    </div>
                    <div class="g_id_signin" data-type="standard" data-shape="rectangular" data-theme="outline"
                        data-text="signin_with" data-size="large" data-logo_alignment="left" style="z-index: 2000;">
                    </div>
                </div>

                <button type="button" class="btn-submit" onclick="submitDraft()">é€å‡ºç•™è¨€ (è«‹å…ˆç™»å…¥)</button>
            </form>

        </div>
    </div>

    <!-- ç®¡ç†è€…ä»‹é¢ Modal (åˆä½µè¨­å®š) -->
    <div id="adminModal" class="modal-overlay" onclick="if(event.target === this) closeModal('adminModal')">
        <div class="modal-content" style="max-width: 800px; width: 95%;">
            <span class="modal-close" onclick="closeModal('adminModal')">&times;</span>
            <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 1rem;">
                <h2 style="color: var(--warm-brown); margin: 0;">ç®¡ç†å¾Œå°</h2>
                <a id="admin-sheet-link"
                    href="https://docs.google.com/spreadsheets/d/1NvB-zNotehm14SQRVR3XgppiLtMA2ZBL-7bqDG2bYmI/edit?gid=0#gid=0"
                    target="_blank" title="é–‹å•Ÿé›²ç«¯è©¦ç®—è¡¨åŸå§‹è³‡æ–™"
                    style="color: #27ae60; font-size: 1.2rem; text-decoration: none; display: none;">
                    <i class="fas fa-file-excel"></i>
                </a>
            </div>



            <div id="admin-management-ui" style="margin-top: 2rem;">
                <h3 style="font-size: 1rem; margin-bottom: 1rem; color: #b07d62;">ç•™è¨€å…§å®¹ç®¡ç†</h3>

                <div id="admin-login-ui">
                    <p style="font-size: 0.85rem; color: #8d7b70; margin-bottom: 10px;">è«‹è¼¸å…¥å¯†ç¢¼è§£é–ç®¡ç†å“¡æ¬Šé™</p>
                    <div style="display: flex; gap: 10px;">
                        <input type="password" id="adminPassword" placeholder="ç®¡ç†å¯†ç¢¼" style="flex: 1;">
                        <button class="btn-submit" style="padding: 0 20px;" onclick="doAdminLogin()">è§£é–</button>
                    </div>
                </div>

                <div id="admin-panel" style="display:none; margin-top: 1rem;">
                    <div class="admin-tabs">
                        <div class="tab-btn active" onclick="switchTab('å¾…å¯©æ ¸')">å¾…å¯©æ ¸</div>
                        <div class="tab-btn" onclick="switchTab('é€šé')">å·²é€šé</div>
                        <div class="tab-btn" onclick="switchTab('é§å›')">å·²é§å›</div>
                        <div class="tab-btn" onclick="switchTab('å·²ä¸‹æ¶')">å·²ä¸‹æ¶</div>
                    </div>

                    <div id="tab-content-list" class="tab-pane">
                        <div class="batch-actions" id="batch-actions-bar">
                            <input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)"
                                style="width:20px; height:20px;">
                            <label for="selectAll">å…¨é¸</label>
                            <button class="btn-approve" onclick="batchUpdate('é€šé')">æ‰¹æ¬¡é€šé</button>
                            <button class="btn-reject" onclick="batchUpdate('é§å›')">æ‰¹æ¬¡é§å›</button>
                        </div>
                        <ul id="admin-msg-list" class="admin-list"></ul>
                    </div>
                </div>
            </div>

            <div style="text-align: right; margin-top: 1rem;">
                <button onclick="logoutAdmin()"
                    style="font-size: 0.8rem; border:none; background:none; text-decoration: underline; color: #999; cursor:pointer;">ç™»å‡ºç®¡ç†å“¡èº«åˆ†</button>
            </div>
        </div>
    </div>
    </div>


    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        // --- è¨­å®šèˆ‡è®Šæ•¸ ---
        const _G = "https://script.google.com/macros/s/AKfycbzZOrUP3veKI5oexCOwUHqLXeduo4bRlpRoglpCF-zl1NxeLuKDTBcJg7o0Acx9qC0R/exec";
        let currentUserEmail = null;
        let currentUserName = null;
        let allMessages = [];
        let usedIndexes = new Set(); // ç”¨æ–¼è¿½è¹¤å·²é¡¯ç¤ºçš„ç•™è¨€ç´¢å¼•
        let likedMessages = JSON.parse(localStorage.getItem('liked_messages') || '[]'); // å·²æŒ‰è®šçš„ç•™è¨€ ID

        // æ•æ„Ÿè©æ¸…å–®ï¼ˆå¯è‡ªè¡Œæ“´å……ï¼‰
        const SENSITIVE_WORDS = [
            'ç¬¨è›‹', 'ç™½ç™¡', 'å»æ­»', 'æ™ºéšœ', 'å»¢ç‰©', 'åƒåœ¾', 'æ»¾', 'çˆ›',
            'å¹¹', 'é ', 'åª½çš„', 'ä»–åª½', 'å±', 'è³¤', 'å©Š', 'æ¸£',
            'fuck', 'shit', 'damn', 'bitch', 'stupid', 'idiot'
        ];

        // --- æ•æ„Ÿè©æª¢æ¸¬ ---
        function containsSensitiveWords(text) {
            const lowerText = text.toLowerCase();
            return SENSITIVE_WORDS.some(word => lowerText.includes(word.toLowerCase()));
        }

        // --- å„ªå…ˆé †åºé‚è¼¯ ---
        function getGasUrl() {
            return _G;
        }



        // --- åˆå§‹åŒ–é é¢ ---
        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const isDisplayMode = urlParams.has('view') && urlParams.get('view') === 'wall';
            const isAdminMode = urlParams.has('admin');

            // é è¨­çš†ç‚ºæŠ•ç¨¿æ¨¡å¼ï¼Œé™¤éæ˜ç¢ºé–‹å•Ÿé¡¯ç¤ºç‰†æˆ–ç®¡ç†æ¨¡å¼
            if (!isDisplayMode && !isAdminMode) {
                document.body.classList.add('post-only-mode');
            }

            const url = getGasUrl();
            // åªæœ‰åœ¨é¡¯ç¤ºæ¨¡å¼æˆ–ç®¡ç†æ¨¡å¼ä¸‹ï¼Œæ‰è¼‰å…¥ç•™è¨€
            if (url && (isDisplayMode || isAdminMode)) {
                loadMessages();
                setInterval(loadMessages, 20000); // æ¯ 20 ç§’æ›´æ–°ä¸€æ¬¡è³‡æ–™åº«
            }

            // é›»è¦–ç‰†ç©©å®šæ€§ï¼šæ¯ 2 å°æ™‚è‡ªå‹•é‡æ–°æ•´ç†ä¸€æ¬¡ç¶²é ï¼Œç¢ºä¿ code æ›´æ–°èˆ‡ç©©å®š
            if (isDisplayMode) {
                setInterval(() => location.reload(), 7200000);
            }

            // é ç”Ÿæˆåˆ†äº«ç”¨çš„å¯«ç•™è¨€ QR Code (æŒ‡å‘é è¨­æ¨¡å¼)
            generateWriteQrCode();

            // é—œéµåŠŸèƒ½ï¼šæŠ•ç¨¿åµæ¸¬ï¼ˆé è¨­æ¨¡å¼ä¹Ÿæœƒè‡ªå‹•é–‹å•Ÿï¼‰
            if (urlParams.has('write') || (!isDisplayMode && !isAdminMode)) {
                setTimeout(openPostModal, 1500);
            }

            // ç›´æ¥é€²å…¥ç®¡ç†å¾Œå°æª¢æ¸¬
            if (urlParams.has('admin')) {
                setTimeout(openAdminModal, 500);
            }

            setInterval(rotateMessages, 2000);
        };

        // --- ç”Ÿæˆå¯«ç•™è¨€å°ˆç”¨ QR Code ---
        function generateWriteQrCode() {
            const qrImg = document.getElementById('fabQrImg');
            if (!qrImg) return;

            // å–å¾—ç›®å‰é é¢ç¶²å€ï¼ˆä¸å«åƒæ•¸ï¼‰
            let currentUrl = window.location.origin + window.location.pathname;
            if (window.location.protocol === 'file:') {
                currentUrl = window.location.href.split('?')[0];
            }

            // ç”Ÿæˆå¯«ç•™è¨€åˆ†äº«é€£çµ (ä¸å†éœ€è¦ config åƒæ•¸)
            const fullShareUrl = `${currentUrl}?write=true`;
            qrImg.src = `https://quickchart.io/qr?text=${encodeURIComponent(fullShareUrl)}&size=200&margin=1&dark=c23a3a&light=ffffff`;
            console.log("å·²ç”Ÿæˆå¯«ç•™è¨€å°ˆç”¨åˆ†äº«é€£çµ");
        }


        // --- åˆ‡æ›é¡¯ç¤º/éš±è—åˆ†äº« QR Code ---
        function toggleShareWriteQr() {
            const wrapper = document.getElementById('shareWriteQrWrapper');
            const btn = document.getElementById('shareWriteBtn');
            const gasUrl = getGasUrl();

            // æª¢æŸ¥æ˜¯å¦å·²è¨­å®š GAS URL
            if (!gasUrl || gasUrl === '') {
                showModal('å°šæœªè¨­å®š', 'è«‹å…ˆåœ¨ç®¡ç†å¾Œå°è¨­å®š GAS é€£ç·šç¶²å€å¾Œï¼Œæ‰èƒ½ç”Ÿæˆåˆ†äº«ç”¨çš„ QR Code', 'warning');
                return;
            }

            const isVisible = wrapper.style.display !== 'none';

            if (isVisible) {
                wrapper.style.display = 'none';
                btn.classList.remove('active');
            } else {
                generateWriteQrCode(); // ç¢ºä¿ QR Code æ˜¯æœ€æ–°çš„
                wrapper.style.display = 'block';
                btn.classList.add('active');

                // æç¤ºä½¿ç”¨è€…
                showModal('åˆ†äº« QR Code', 'è®“å…¶ä»–äººæƒç¢¼å³å¯ç›´æ¥ç•™è¨€ï¼Œç„¡éœ€è¨­å®šï¼', 'success');
            }
        }


        // --- åˆ‡æ›åŒ¿åæš±ç¨±è¼¸å…¥ ---
        function toggleAnonymousName() {
            const wrapper = document.getElementById('anonymousNameWrapper');
            const checkbox = document.getElementById('isAnonymous');
            wrapper.style.display = checkbox.checked ? 'block' : 'none';
        }

        // --- æ„›å¿ƒæŒ‰è®š ---
        async function toggleLike(msgId, btn) {
            const isLiked = likedMessages.includes(msgId);
            const increment = isLiked ? -1 : 1;

            // æ›´æ–°æœ¬åœ°ç‹€æ…‹
            if (isLiked) {
                likedMessages = likedMessages.filter(id => id !== msgId);
                btn.classList.remove('liked');
            } else {
                likedMessages.push(msgId);
                btn.classList.add('liked');
            }

            localStorage.setItem('liked_messages', JSON.stringify(likedMessages));

            // æ›´æ–° UI ä¸Šçš„è¨ˆæ•¸ (æ›´ç©©å¥çš„é¸å–æ–¹å¼)
            let countEl = btn.querySelector('.like-count');
            if (!countEl) {
                // å¦‚æœåŸæœ¬æ²’æœ‰è¨ˆæ•¸æ¨™ç±¤ï¼Œå‹•æ…‹å‰µå»ºä¸€å€‹
                countEl = document.createElement('span');
                countEl.className = 'like-count';
                btn.appendChild(countEl);
            }

            let count = parseInt(countEl.textContent) || 0;
            count = Math.max(0, count + increment);
            countEl.textContent = count > 0 ? count : '';

            // åŒæ­¥åˆ°å¾Œç«¯
            await fetchAPI('toggleLike', null, { id: msgId, increment: increment });
        }




        // --- API ä¸²æ¥ ---
        async function fetchAPI(action, data = null, params = null) {
            const url = getGasUrl();
            if (!url) {
                showModal('éŒ¯èª¤', 'æœªè¨­å®š GAS ç¶²å€', 'error');
                return null;
            }

            try {
                // ä¿®æ­£é‚è¼¯ï¼šåˆ¤æ–·å“ªäº›è¡Œå‹•æ‡‰è©²ä½¿ç”¨ POST
                const isPost = (action === 'submitMessage' || action === 'updateStatus' || action === 'updatePin' || action === 'adminGetMessages');

                const options = {
                    method: isPost ? 'POST' : 'GET',
                    mode: 'cors'
                };

                let targetUrl = url;
                if (!isPost) {
                    // å…¨é¢ä¿®å¾©ï¼šæ‰€æœ‰ GET è«‹æ±‚éƒ½å¿…é ˆåŒ…å« action èˆ‡åƒæ•¸
                    targetUrl += `?action=${action}`;
                    if (params) {
                        for (let k in params) targetUrl += `&${k}=${encodeURIComponent(params[k])}`;
                    }
                } else {
                    // POST è«‹æ±‚ï¼šå°‡è³‡æ–™èˆ‡è¡Œå‹•åŒ…è£åœ¨ Body
                    options.body = JSON.stringify({ ...data, action, ...params }); // Merge params into body for POST
                }

                const response = await fetch(targetUrl, options);
                const result = await response.json();

                if (result.error) {
                    showModal('API è¨Šæ¯', result.error, 'warning');
                    return null;
                }
                return result;
            } catch (err) {
                console.error(err);
                showModal('é€£ç·šå¤±æ•—', 'ç„¡æ³•èˆ‡æœå‹™ç«¯é€šè¨Šï¼Œè«‹æª¢æŸ¥ç¶²å€æ˜¯å¦æ­£ç¢ºã€‚', 'error');
                return null;
            }
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šè®€å–ç•™è¨€ ---
        async function loadMessages() {
            const board = document.getElementById('messageBoard');
            const result = await fetchAPI('getMessages');
            if (result && !result.error) {
                allMessages = result;
                if (allMessages.length === 0) {
                    board.innerHTML = '<div style="opacity:0.5;">ç›®å‰é‚„æ²’æœ‰æº«æš–çš„ç•™è¨€ï¼Œå¿«ä¾†å¯«ç¬¬ä¸€å‰‡å§ï¼</div>';
                } else if (board.innerHTML.includes('ç›®å‰é‚„æ²’æœ‰')) {
                    board.innerHTML = '';
                }
                // ä¸å†åŸ·è¡Œ board.innerHTML = ''ï¼Œè®“ rotateMessages è‡ªç„¶æ›´è¿­ç•™è¨€
            }
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šéš¨æ©Ÿæ—‹è½‰ç•™è¨€å¡ç‰‡ ---
        let displayingIndexes = new Set(); // è¿½è¹¤ç•¶å‰æ­£åœ¨ç•«é¢ä¸Šçš„å¡ç‰‡

        function rotateMessages() {
            if (allMessages.length === 0) return;

            const board = document.getElementById('messageBoard');
            if (!board) return;
            const boardWidth = board.clientWidth;
            const boardHeight = board.clientHeight;

            // èª¿æ•´å…±å­˜å¡ç‰‡æ•¸é‡
            const maxOnScreen = Math.min(window.innerWidth < 600 ? 3 : 6, allMessages.length);
            const currentCards = board.querySelectorAll('.message-card');

            if (currentCards.length < maxOnScreen) {
                // å„ªå…ˆé¸æ“‡ã€Œé‡˜é¸ã€ä¸”ä¸åœ¨ç•«é¢ä¸Šçš„ç•™è¨€
                let pinnedAvailable = [];
                let normalAvailable = [];

                for (let i = 0; i < allMessages.length; i++) {
                    if (!displayingIndexes.has(i)) {
                        if (allMessages[i].isPinned) pinnedAvailable.push(i);
                        else normalAvailable.push(i);
                    }
                }

                if (pinnedAvailable.length > 0) {
                    // ç‚ºäº†ç¢ºä¿é‡˜é¸å…¬å‘Šèƒ½ç¬¬ä¸€æ™‚é–“å‡ºç¾åœ¨ç•«é¢ä¸Šï¼Œ
                    // åªè¦æœ‰é‡˜é¸ç•™è¨€ä¸”ä¸åœ¨ç•«é¢ä¸Šï¼Œå°±ç«‹å³è¼‰å…¥ã€‚
                    randomPick = pinnedAvailable[Math.floor(Math.random() * pinnedAvailable.length)];
                } else if (normalAvailable.length > 0) {
                    randomPick = normalAvailable[Math.floor(Math.random() * normalAvailable.length)];
                } else {
                    return;
                }

                displayingIndexes.add(randomPick);
                createCard(allMessages[randomPick], boardWidth, boardHeight, randomPick);
            }
        }

        // é è¨ˆç®—ä½ç½®ï¼ˆæ›´è‡ªç„¶çš„æ•£ä½ˆï¼‰
        let gridPositions = [];
        let positionIndex = 0;

        function calculateGridPositions() {
            gridPositions = [];
            const bw = window.innerWidth;
            const bh = window.innerHeight;
            const cardW = 340;
            const cardH = 260; // ç¨å¾®å¢åŠ é ä¼°é«˜åº¦

            // è¨­å®šé‚Šç•Œå®‰å…¨ç¯„åœ (é¿å…è²¼é‚Šæˆ–è¶…å‡º)
            const margin = 30;
            const availableW = bw - (margin * 2);
            const availableH = bh - (margin * 2); // ç§»é™¤ä¸‹æ–¹é ç•™ç©ºé–“ï¼Œå…è¨±å¡ç‰‡è¦†è“‹æŒ‰éˆ•

            const cols = Math.max(1, Math.floor(availableW / (cardW + 20)));
            const rows = Math.max(1, Math.floor(availableH / (cardH + 20)));

            const gapX = cols > 1 ? (availableW - cols * cardW) / (cols - 1) : 0;
            const gapY = rows > 1 ? (availableH - rows * cardH) / (rows - 1) : 0;

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const startX = (bw - (cols * cardW + (cols - 1) * gapX)) / 2;
                    const startY = margin + 40;

                    gridPositions.push({
                        x: startX + c * (cardW + gapX) + (Math.random() - 0.5) * 30,
                        y: startY + r * (cardH + gapY) + (Math.random() - 0.5) * 30,
                        rot: (Math.random() - 0.5) * 8
                    });
                }
            }
            gridPositions.sort(() => Math.random() - 0.5);
        }

        // --- è¿½è¹¤é‡˜é¸å…¬å‘Šå‚ç›´å †ç–Šç‹€æ…‹ ---
        let pinnedCount = 0;

        function createCard(msg, bw, bh, index) {
            const board = document.getElementById('messageBoard');
            const card = document.createElement('div');
            const isPinned = msg.isPinned === true;
            card.className = `message-card animate-float ${isPinned ? 'pinned-card' : ''}`;

            let finalX, finalY, finalRot;

            if (isPinned) {
                // é‡˜é¸å…¬å‘Šï¼šå›ºå®šåœ¨å·¦å´ã€Œå»ºæˆå¿ƒèƒ½é‡ã€æ¨™é¡Œä¸‹æ–¹
                // çµ±è¨ˆç›®å‰ç•«é¢ä¸Šå·²æœ‰çš„é‡˜é¸å¡ç‰‡æ•¸é‡
                const existingPinned = board.querySelectorAll('.pinned-card').length;

                const margin = 24; // èˆ‡æ¨™é¡Œå°é½Š
                const startY = 100; // æ¨™é¡Œä¸‹æ–¹çš„èµ·å§‹é«˜åº¦
                const spacingY = 280; // æ¯å¼ å¡ç‰‡çš„é«˜åº¦ + é–“è·

                finalX = margin;
                finalY = startY + (existingPinned * spacingY);
                finalRot = -2; // ç¨å¾®å‚¾æ–œæ›´æœ‰è³ªæ„Ÿ
            } else {
                // ä¸€èˆ¬ç•™è¨€ï¼šä½¿ç”¨ç¶²æ ¼ä½ç½®
                if (gridPositions.length === 0 || positionIndex >= gridPositions.length) {
                    calculateGridPositions();
                    positionIndex = 0;
                }
                const pos = gridPositions[positionIndex];
                positionIndex++;

                finalX = pos.x;
                finalY = pos.y;
                finalRot = pos.rot;
            }

            // å®‰å…¨é™åˆ¶ï¼šç¢ºä¿ left/top ä¸æœƒè®“å¡ç‰‡è¶…å‡º
            const safeX = Math.max(10, Math.min(finalX, bw - 350));
            const safeY = Math.max(50, Math.min(finalY, bh - 280));

            card.style.setProperty('--rot', `${finalRot}deg`);
            card.style.top = `${safeY}px`;
            card.style.left = `${safeX}px`;

            // æª¢æŸ¥æ˜¯å¦å·²æŒ‰è®š
            const isLiked = likedMessages.includes(msg.id);
            const heartIcon = isLiked ? 'fas fa-heart' : 'far fa-heart';
            const likedClass = isLiked ? 'liked' : '';

            // éš¨æ©Ÿè† å¸¶ä½ç½®é‚è¼¯
            const tapePos = Math.random() > 0.5 ? '20px' : '230px';
            const tapeRot = (Math.random() * 20 - 10) + (tapePos === '20px' ? -15 : 15);
            card.style.setProperty('--tape-pos', tapePos);
            card.style.setProperty('--tape-rot', tapeRot + 'deg');

            // --- å…§å®¹è™•ç†ï¼šMarkdown èˆ‡ æ›è¡Œåµæ¸¬ ---
            const hasNewline = msg.content.includes('\n');
            const renderedContent = typeof marked !== 'undefined' ? marked.parse(msg.content) : msg.content;

            // --- æ›´ç´°ç·»çš„å­—ç´šå„ªåŒ–ï¼Œé¿å…å…§å®¹æ’å¤§å¡ç‰‡ ---
            const contentLen = msg.content.length;
            let sizeClass = "size-small";
            if (contentLen < 35) sizeClass = "size-large";
            else if (contentLen < 65) sizeClass = "size-medium";
            else if (contentLen > 110) sizeClass = "size-mini"; // å…§å®¹è¶…é•·æ™‚ç¸®åˆ°æœ€å°

            card.innerHTML = `
                <div class="card-greeting">${isPinned ? 'ğŸ“Œ è¡Œæ”¿å…¬å‘Šï¼š' : 'è‡´ï¼š'}${msg.target}</div>
                <div class="card-content ${sizeClass} ${hasNewline ? 'has-newline' : ''}">${renderedContent}</div>
                <div class="card-footer">
                    <div class="card-tag ${isPinned ? 'badge-pinned' : 'tag-' + msg.tag}">${isPinned ? 'ğŸ“Œ é‡è¦å…¬å‘Š' : msg.tag}</div>
                    <div class="card-author">${msg.displayName}</div>
                </div>
                <button class="card-like ${likedClass}" onclick="toggleLike('${msg.id}', this)" title="é€ä»–ä¸€å€‹å¿ƒ">
                    <i class="fas fa-heart"></i>
                    ${msg.likes > 0 ? `<span class="like-count">${msg.likes}</span>` : ''}
                </button>
            `;








            board.appendChild(card);

            // éš¨æ©Ÿå‹•ç•«å»¶é²
            card.style.animationDelay = `0s, ${Math.random() * 2}s`;


            // é—œéµå®‰å…¨é–ï¼šè‹¥ç‚ºé‡˜é¸å…¬å‘Šï¼Œå¼·åˆ¶è·³å‡ºç§»é™¤é‚è¼¯ï¼Œçµ•å°ä¸æ¶ˆå¤±
            if (isPinned) return;

            // ä¸€èˆ¬ç•™è¨€ï¼š11 ç§’å¾Œå•Ÿå‹•æ¶ˆå¤±å‹•ç•«
            setTimeout(() => {
                card.classList.add('fade-out');
                setTimeout(() => {
                    card.remove();
                    displayingIndexes.delete(index);
                }, 1000);
            }, 11000);
        }



        // --- Google ç™»å…¥è™•ç† ---
        function handleCredentialResponse(response) {
            const payload = parseJwt(response.credential);
            const email = payload.email;
            const domain = "@stweb.jcjh.tp.edu.tw";

            if (!email.endsWith(domain)) {
                showModal('ç¶²åŸŸéŒ¯èª¤', `æŠ±æ­‰ï¼Œæœ¬ç•™è¨€æ¿åƒ…é™å»ºæˆåœ‹ä¸­å­¸ç”Ÿå¸³è™Ÿ (${domain}) ä½¿ç”¨ã€‚`, 'error');
                return;
            }

            currentUserEmail = email;
            currentUserName = payload.name;

            const loginContainer = document.getElementById('google-login-container');
            loginContainer.innerHTML = `<p style="color: #27ae60; font-weight: bold;">âœ… å·²èªè­‰ï¼š${currentUserName}</p>`;

            document.querySelector('.btn-submit[onclick="submitDraft()"]').textContent = "ç¢ºèªé€å‡ºç•™è¨€";
        }

        function parseJwt(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        // --- é€å‡ºç•™è¨€ ---
        async function submitDraft() {
            if (!currentUserEmail) {
                showModal('æç¤º', 'è«‹å…ˆä½¿ç”¨å­¸æ ¡ Google å¸³è™Ÿç™»å…¥ï¼Œä»¥ç¶­è­·æ ¡åœ’ç•™è¨€ç’°å¢ƒã€‚', 'warning');
                return;
            }

            const content = document.getElementById('content').value;
            const target = document.getElementById('target').value;

            // æ•æ„Ÿè©æª¢æ¸¬
            if (containsSensitiveWords(content) || containsSensitiveWords(target)) {
                showModal('å…§å®¹ä¸ç•¶', 'æ‚¨çš„ç•™è¨€åŒ…å«ä¸æ°ç•¶çš„ç”¨èªï¼Œè«‹ä¿®æ”¹å¾Œé‡æ–°é€å‡ºã€‚è®“æˆ‘å€‘ä¸€èµ·ç¶­è­·å‹å–„çš„æ ¡åœ’ç’°å¢ƒ ğŸ’', 'warning');
                return;
            }

            const isAnonymous = document.getElementById('isAnonymous').checked;
            const anonymousName = document.getElementById('anonymousName')?.value?.trim() || '';

            const data = {
                target: target,
                tag: document.getElementById('tag').value,
                content: content,
                isAnonymous: isAnonymous,
                anonymousName: isAnonymous ? (anonymousName || 'å°å¤©ä½¿') : '',
                email: currentUserEmail,
                name: currentUserName
            };

            if (!data.target || !data.content) {
                showModal('å¡«å¯«æœªå®Œæˆ', 'è«‹å¡«å¯«ç•™è¨€å°è±¡èˆ‡å…§å®¹ã€‚', 'warning');
                return;
            }

            const btn = document.querySelector('.btn-submit[onclick="submitDraft()"]');
            btn.disabled = true;
            btn.textContent = "å‚³é€ä¸­...";

            const res = await fetchAPI('submitMessage', data);

            if (res && res.status === "success") {
                const isPostOnly = document.body.classList.contains('post-only-mode');

                if (isPostOnly) {
                    // æŠ•ç¨¿æ¨¡å¼ï¼šä¸é—œé–‰è¦–çª—ï¼Œæ”¹ç‚ºé¡¯ç¤ºæ„Ÿè¬ç•«é¢
                    const modalContent = document.querySelector('#postModal .modal-content');
                    modalContent.innerHTML = `
                        <div style="text-align: center; padding: 2rem 1rem;">
                            <div class="pulsate" style="font-size: 4rem; color: #27ae60; margin-bottom: 1.5rem;">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h2 style="color: var(--warm-brown); margin-bottom: 1rem;">æŠ•ç¨¿æˆåŠŸï¼</h2>
                            <p style="font-size: 1.1rem; color: #666; line-height: 1.6; margin-bottom: 2rem;">
                                ç•™è¨€å¯©æ ¸å¾Œå°‡é¡¯ç¤ºæ–¼<br><strong style="color: var(--primary-coral); font-size: 1.3rem;">ã€Œæ–¼åº­é›»è¦–ç‰†ã€</strong>
                            </p>
                            <button class="btn-submit" onclick="location.reload()" style="width: auto; padding: 0.8rem 2.5rem;">
                                <i class="fas fa-feather-alt"></i> å†å¯«ä¸€å‰‡
                            </button>
                        </div>
                    `;
                    showModal('é€å‡ºæˆåŠŸ', 'æ„Ÿè¬æ‚¨çš„æº«æš–æŠ•ç¨¿ï¼', 'success');
                } else {
                    showModal('é€å‡ºæˆåŠŸ', res.message, 'success');
                    closeModal('postModal');
                    document.getElementById('postForm').reset();
                }
            } else {
                showModal('å¤±æ•—', 'ç•™è¨€é€å‡ºå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚', 'error');
            }

            btn.disabled = false;
            btn.textContent = "ç¢ºèªé€å‡ºç•™è¨€";
        }

        // --- ç®¡ç†å¾Œå°è™•ç† ---
        let adminRawData = [];
        let currentTab = "å¾…å¯©æ ¸";

        async function doAdminLogin() {
            const password = document.getElementById('adminPassword').value;
            // ä¿®æ­£ï¼šfetchAPI çš„åƒæ•¸èª¿ç”¨æ–¹å¼èˆ‡ loadAdminMessages ä¿æŒä¸€è‡´
            const res = await fetchAPI('adminGetMessages', { password });

            if (res && res.messages) {
                localStorage.setItem('admin_password', password);
                renderAdminUI(res);
            } else {
                showModal('éŒ¯èª¤', res.error || 'å¯†ç¢¼ä¸æ­£ç¢ºã€‚', 'error');
            }
        }

        function renderAdminUI(data) {
            // ä¿®æ­£ï¼šå¾å›å‚³ç‰©ä»¶ä¸­æå– messages é™£åˆ—
            adminRawData = data.messages || [];
            document.getElementById('admin-login-ui').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';

            // åŒæ­¥æ›´æ–°èˆ‡é¡¯ç¤ºè©¦ç®—è¡¨é€£çµ
            const sheetLink = document.getElementById('admin-sheet-link');
            if (sheetLink) {
                if (data.sheetUrl) sheetLink.href = data.sheetUrl;
                sheetLink.style.display = 'inline-block';
            }

            switchTab(currentTab);
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.toggle('active', b.textContent === tab);
            });

            const list = document.getElementById('admin-msg-list');
            list.innerHTML = '';
            // ä¿®æ­£ï¼šæ‰€æœ‰åˆ†é éƒ½æ”¯æ´æ‰¹æ¬¡ç®¡ç†
            document.getElementById('batch-actions-bar').style.display = 'flex';

            // æ‰¹æ¬¡æŒ‰éˆ•å‹•æ…‹èª¿æ•´é¡è‰² (å¦‚æœæ˜¯é§å›æˆ–ä¸‹æ¶åˆ†é ï¼ŒæŒ‰éˆ•åŠŸèƒ½ä¸è®Šä½†é¡¯ç¤ºä¸Šæ›´ç›´è¦º)
            const approveBtn = document.querySelector('.btn-approve');
            const rejectBtn = document.querySelector('.btn-reject');
            if (tab === 'é€šé') {
                approveBtn.style.display = 'none';
                rejectBtn.textContent = 'æ‰¹æ¬¡é§å›';
            } else if (tab === 'é§å›') {
                approveBtn.style.display = 'inline-block';
                approveBtn.textContent = 'æ‰¹æ¬¡é€šé';
                rejectBtn.style.display = 'none';
            } else if (tab === 'å·²ä¸‹æ¶') {
                approveBtn.style.display = 'inline-block';
                approveBtn.textContent = 'é‡æ–°ä¸Šæ¶';
                rejectBtn.textContent = 'æ‰¹æ¬¡é§å›';
            } else {
                approveBtn.style.display = 'inline-block';
                approveBtn.textContent = 'æ‰¹æ¬¡é€šé';
                rejectBtn.style.display = 'inline-block';
                rejectBtn.textContent = 'æ‰¹æ¬¡é§å›';
            }

            const now = new Date().getTime();
            const twoWeeksMs = 14 * 24 * 60 * 60 * 1000;

            const filtered = adminRawData.filter(m => {
                const messageTime = new Date(m.timestamp).getTime();
                const isExpired = (now - messageTime) > twoWeeksMs;

                if (tab === 'å·²ä¸‹æ¶') {
                    // For 'å·²ä¸‹æ¶' tab, show messages that were 'é€šé' and are now expired,
                    // but exclude pinned messages from being considered 'expired' for display here.
                    return m.status === 'é€šé' && isExpired && !m.isPinned;
                } else if (tab === 'é€šé') {
                    // For 'é€šé' tab, show messages that are 'é€šé' and not expired, or are pinned.
                    return m.status === 'é€šé' && (!isExpired || m.isPinned);
                } else {
                    return m.status === tab;
                }
            });

            if (filtered.length === 0) {
                list.innerHTML = `<li style="text-align:center; padding: 2rem; color: #999;">ç›®å‰æ²’æœ‰${tab}çš„ç•™è¨€ã€‚</li>`;
                return;
            }

            filtered.forEach(m => {
                const li = document.createElement('li');
                li.className = 'admin-item';
                const msgDate = new Date(m.timestamp);
                const isExpired = (new Date().getTime() - msgDate.getTime()) > twoWeeksMs;
                const expiredBadge = (m.status === 'é€šé' && isExpired && !m.isPinned) ? `<span style="background:#eee; color:#999; padding:2px 6px; border-radius:4px; font-size:10px; margin-left:5px;">æ™‚æ•ˆå·²å±†</span>` : '';

                const dateStr = msgDate.toLocaleString('zh-TW', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                li.innerHTML = `
                    <input type="checkbox" class="msg-checkbox item-checkbox" value="${m.id}">
                    <div class="item-info">
                        <div class="item-meta">${dateStr} Â· <span class="item-target">${m.target}</span> Â· ${m.tag} ${expiredBadge}</div>
                        <div class="item-content">${m.content}</div>
                        <div style="font-size:0.75rem; color:#888; margin-top:2px;">
                            é¡¯ç¤ºï¼š${m.displayName} ï½œ çœŸå¯¦ï¼š${m.realName || 'ä¸å…·å'}ï¼ˆ${m.account}ï¼‰
                        </div>
                    </div>
                    <div class="admin-actions">
                        <button class="btn-approve" style="background: ${m.isPinned ? '#f39c12' : '#95a5a6'}; min-width: 40px;"
                            onclick="togglePin('${m.id}', ${!m.isPinned})" title="${m.isPinned ? 'å–æ¶ˆé‡˜é¸' : 'é‡˜é¸ç‚ºå…¬å‘Š'}">
                            <i class="fas fa-thumbtack"></i>
                        </button>
                        ${(m.status !== 'é€šé' || (isExpired && !m.isPinned)) ? `<button class="btn-approve" onclick="updateStatus('${m.id}', 'é€šé')" title="é‡æ–°ä¸Šæ¶">âœ“</button>` : ''}
                        ${m.status !== 'é§å›' ? `<button class="btn-reject" onclick="updateStatus('${m.id}', 'é§å›')">âœ—</button>` : ''}
                    </div>
                `;
                list.appendChild(li);
            });
        }


        async function batchUpdate(status) {
            const checkboxes = document.querySelectorAll('.msg-checkbox:checked');
            const ids = Array.from(checkboxes).map(cb => cb.value);
            if (ids.length === 0) {
                showModal('æç¤º', 'è«‹å…ˆå‹¾é¸è¦è™•ç†çš„ç•™è¨€ã€‚', 'info');
                return;
            }

            const password = localStorage.getItem('admin_password');
            let successCount = 0;

            Swal.fire({ title: 'æ‰¹æ¬¡è™•ç†ä¸­...', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });

            for (const id of ids) {
                const res = await fetchAPI('updateStatus', { id, status, password });
                if (res && res.status === "success") successCount++;
            }

            Swal.close();
            showModal('å®Œæˆ', `å·²æˆåŠŸè™•ç† ${successCount} å‰‡ç•™è¨€ã€‚`, 'success');
            loadAdminMessages(); // é‡æ–°æ•´ç†è³‡æ–™
            loadMessages(); // å‰å°æ›´æ–°
        }

        async function loadAdminMessages() {
            const password = localStorage.getItem('admin_password');
            if (!password) return;

            const res = await fetchAPI('adminGetMessages', { password });
            if (res && res.messages) {
                adminRawData = res.messages;
                switchTab(currentTab);
            } else if (res && res.error) {
                showModal('éŒ¯èª¤', res.error, 'error');
                // If there's an error, ensure the login UI is visible
                document.getElementById('admin-login-ui').style.display = 'block';
                document.getElementById('admin-panel').style.display = 'none';
                const loadingHint = document.getElementById('admin-loading-hint');
                if (loadingHint) loadingHint.style.display = 'none';
            }
        }

        function logoutAdmin() {
            localStorage.removeItem('admin_password');
            location.reload();
        }

        function toggleSelectAll(source) {
            const checkboxes = document.querySelectorAll('.msg-checkbox');
            checkboxes.forEach(cb => cb.checked = source.checked);
        }

        async function updateStatus(id, newStatus) {
            const password = localStorage.getItem('admin_password');
            const res = await fetchAPI('updateStatus', { id, status: newStatus, password });
            if (res && res.status === "success") {
                loadAdminMessages();
                loadMessages();
            }
        }

        async function togglePin(id, isPinned) {
            const password = localStorage.getItem('admin_password');
            const res = await fetchAPI('updatePin', { id, isPinned, password });
            if (res && res.status === "success") {
                loadAdminMessages();
                loadMessages();
                showModal('å·²æ›´æ–°', isPinned ? 'å·²æˆåŠŸé‡˜é¸ç‚ºå…¬å‘Š' : 'å·²å–æ¶ˆé‡˜é¸', 'success');
            }
        }

        // --- è¨­å®šèˆ‡å·¥å…· ---
        // --- ç”Ÿæˆå­¸ç”Ÿå¯«ç•™è¨€å°ˆç”¨åˆ†äº«é€£çµ ---
        function generateWriteShareLink() {
            const area = document.getElementById('write-share-area');
            const baseUrl = window.location.href.split('?')[0];
            const writeShareUrl = `${baseUrl}?write=true`;

            // é¡¯ç¤ºå€åŸŸ
            area.style.display = 'block';
            document.getElementById('writeShareUrlDisplay').value = writeShareUrl;

            // ç”Ÿæˆé«˜å°æ¯”åº¦çš„ QR Codeï¼ˆç¢ºä¿æƒç¢¼æˆåŠŸç‡ï¼‰
            const qrImg = document.getElementById('writeShareQrImg');
            if (qrImg) {
                qrImg.src = `https://quickchart.io/qr?text=${encodeURIComponent(writeShareUrl)}&size=300&margin=2&dark=c23a3a&light=ffffff`;
            }

            showModal('å¯«ç•™è¨€ QR Code å·²ç”¢ç”Ÿï¼', 'æŠŠé€™å€‹ QR Code è²¼åœ¨æ•™å®¤ï¼Œå­¸ç”Ÿæƒç¢¼å°±èƒ½ç›´æ¥å¯«ç•™è¨€ï¼', 'success');
        }

        // --- è¤‡è£½å­¸ç”Ÿå¯«ç•™è¨€å°ˆç”¨é€£çµ ---
        function copyWriteShareUrl() {
            const baseUrl = window.location.href.split('?')[0];
            const writeShareUrl = `${baseUrl}?write=true`;

            // è¤‡è£½åˆ°å‰ªè²¼ç°¿
            navigator.clipboard.writeText(writeShareUrl).then(() => {
                showModal('æˆåŠŸ', 'å¯«ç•™è¨€é€£çµå·²è¤‡è£½ï¼å¯ä»¥åˆ†äº«çµ¦å­¸ç”Ÿä½¿ç”¨', 'success');
            }).catch(() => {
                // fallback æ–¹æ¡ˆ
                const tempInput = document.createElement('input');
                tempInput.value = writeShareUrl;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                showModal('æˆåŠŸ', 'å¯«ç•™è¨€é€£çµå·²è¤‡è£½ï¼', 'success');
            });
        }


        // --- é€šç”¨ UI å‡½å¼ ---
        function showModal(title, message, type = 'info') {
            Swal.fire({
                title,
                text: message,
                icon: type,
                confirmButtonColor: '#e67e22',
                timer: 3000, // 3ç§’å¾Œè‡ªå‹•é—œé–‰
                timerProgressBar: true, // é¡¯ç¤ºé€²åº¦æ¢
                showConfirmButton: type === 'error', // éŒ¯èª¤æ™‚æ‰é¡¯ç¤ºç¢ºèªæŒ‰éˆ•ï¼Œå…¶ä»–ç‹€æ³è‡ªå‹•æ¶ˆå¤±
            });
        }

        function openPostModal() { document.getElementById('postModal').style.display = 'flex'; }
        function openAdminModal() {
            const modal = document.getElementById('adminModal');
            modal.style.display = 'flex';

            const savedPwd = localStorage.getItem('admin_password');
            const loginUI = document.getElementById('admin-login-ui');
            const panelUI = document.getElementById('admin-panel');

            if (savedPwd && panelUI.style.display === 'none') {
                // å¦‚æœæœ‰è¨˜æ†¶å¯†ç¢¼ï¼Œå…ˆéš±è—ç™»å…¥ UI ä¸¦é¡¯ç¤ºè¼‰å…¥ä¸­
                loginUI.style.display = 'none';

                // æª¢æŸ¥æ˜¯å¦å·²æœ‰è¼‰å…¥æç¤ºï¼Œæ²’æœ‰å‰‡å»ºç«‹
                let loadingHint = document.getElementById('admin-loading-hint');
                if (!loadingHint) {
                    loadingHint = document.createElement('div');
                    loadingHint.id = 'admin-loading-hint';
                    loadingHint.style.textAlign = 'center';
                    loadingHint.style.padding = '3rem 1rem';
                    loadingHint.innerHTML = `
                        <div class="pulsate" style="font-size: 2rem; color: var(--primary-coral); margin-bottom: 1rem;">
                            <i class="fas fa-unlock-alt"></i>
                        </div>
                        <p style="color: #8d7b70;">åµæ¸¬åˆ°å„²å­˜çš„æ†‘è­‰ï¼Œè‡ªå‹•ç™»å…¥ä¸­...</p>
                    `;
                    document.getElementById('admin-management-ui').prepend(loadingHint);
                }
                loadingHint.style.display = 'block';

                document.getElementById('adminPassword').value = savedPwd;
                doAdminLogin().then(() => {
                    loadingHint.style.display = 'none';
                });
            } else if (!savedPwd) {
                loginUI.style.display = 'block';
                const loadingHint = document.getElementById('admin-loading-hint');
                if (loadingHint) loadingHint.style.display = 'none';
            }
        }

        function closeModal(id) {
            // åœ¨æŠ•ç¨¿å°ˆç”¨æ¨¡å¼ä¸‹ï¼Œç¦æ­¢é—œé–‰æŠ•ç¨¿è¦–çª—
            if (id === 'postModal' && document.body.classList.contains('post-only-mode')) {
                return;
            }
            document.getElementById(id).style.display = 'none';
        }

        function updateCharCount() {
            const content = document.getElementById('content').value;
            document.getElementById('charCount').textContent = `${content.length} / 60`;
        }
    </script>

    <!-- ç”¨æ–¼æä¾›çµ¦ä½¿ç”¨è€…è¤‡è£½çš„ç¯„æœ¬ -->
</body>

</html>
